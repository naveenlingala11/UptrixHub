<section class="practice">

    <!-- TOP BAR -->
    <header class="topbar">
        <div class="brand">
            <h2>JavaArray Playground</h2>
            <p class="subtitle">Code â€¢ Debug â€¢ Learn like a Pro..! </p>
            <!-- <button class="back-btn" (click)="goHome()" title="Go Home">
  <svg viewBox="0 0 24 24" class="back-icon">
    <path d="M15 18l-6-6 6-6" />
  </svg>
</button> -->
            <button class="back-btn" (click)="goHome()" title="Go Home">
                <i class="fas fa-arrow-left"></i>
            </button>

        </div>

        <div class="actions">
            <button (click)="shareCode()">ğŸ”— Share</button>
            <button (click)="toggleTheme()">ğŸŒ™ Theme</button>
            <button class="run" [disabled]="isRunning" (click)="run(false)">â–¶ Run</button>
            <button class="debug" [disabled]="isRunning" (click)="startDebugSession()">ğŸ Debug</button>
        </div>
    </header>

    <!-- FILE TABS -->
    <div class="tabs">
        <div *ngFor="let f of files; let i = index" class="tab" draggable="true" (dragstart)="onDragStart(i)"
            (dragover)="onDragOver($event)" (drop)="onDrop(i)" [class.active]="i === activeFileIndex"
            (click)="switchFile(i)">
            {{ f.name }}
            <span *ngIf="f.dirty" class="dot">â—</span>

            <span class="close" (click)="closeTab(i, $event)">âœ•</span>
        </div>

        <!-- TAB PREVIEW -->
        <div class="tab-preview" *ngIf="previewFile" [style.top.px]="previewY" [style.left.px]="previewX">
            <strong>{{ previewFile.name }}</strong>
            <pre>{{ previewContent }}</pre>
        </div>

        <div class="tab add" (click)="addFile()">ï¼‹</div>
    </div>

    <!-- DEBUG BAR -->
    <div class="debug-bar" *ngIf="debugSession">
        <div class="debug-actions">
            <button (click)="step()">â­ Step</button>
            <button (click)="stop()">â¹ Stop</button>
        </div>

        <div class="debug-info">
            <span>File: {{ files[activeFileIndex]?.name }}</span>
            <span *ngIf="debugState">Line: {{ debugState.line }}</span>
        </div>
    </div>

    <!-- WORKSPACE -->
    <div class="workspace">
        <div class="project-tree" [class.closed]="!projectTreeOpen">

            <div class="tree-header">
                <h4>ğŸ“ Project</h4>

                <button class="tree-toggle" (click)="toggleProjectTree()" title="Toggle Project Tree">
                    {{ projectTreeOpen ? 'â®œ' : 'â®' }}
                </button>
            </div>

            <ul>
                <li *ngFor="let f of files; let i = index" [class.active]="i === activeFileIndex"
                    (click)="switchFile(i)">
                    {{ f.name }}
                    <span *ngIf="f.dirty">â—</span>
                </li>
            </ul>

        </div>

        <!-- EDITOR -->
        <div class="editor-wrapper">
            <div class="editor-header">
                ğŸ“„ {{ currentClass }}.java
                <span class="editor-hint">Red dots = breakpoints</span>
            </div>

            <div class="editor-box">
                <div #editor class="editor"></div>
            </div>
        </div>

        <div #resizer class="resizer"></div>

        <!-- SIDEBAR -->
        <aside class="sidebar">

            <!-- PROGRAM INPUT -->
            <div class="panel">
                <h4>ğŸ“¥ Program Input</h4>

                <!-- âœ… input-row wrapper added -->
                <div class="input-row">
                    <textarea [(ngModel)]="stdin"></textarea>

                    <!-- âœ… enter button added -->
                    <button class="enter-btn" [disabled]="stdinSent" title="Send Input" (click)="submitInput()">
                        â
                    </button>
                </div>
            </div>

            <!-- DEBUG STATE -->
            <div class="panel" *ngIf="debugState">
                <h4>ğŸ Debug State</h4>
                <p>Line: {{ debugState.line }}</p>
                <p>Source: {{ debugState.source }}</p>

                <h5>ğŸ§  Variables</h5>
                <ul class="mono">
                    <li *ngFor="let v of debugState.locals | keyvalue">
                        {{ v.key }} = {{ v.value }}
                    </li>
                </ul>
            </div>

            <!-- WATCH VARIABLES -->
            <div class="panel">
                <h4>ğŸ‘ Watch Variables</h4>

                <!-- âœ… input-row wrapper added -->
                <div class="input-row">
                    <input placeholder="variable name" #watchInput
                        (keyup.enter)="addWatch(watchInput.value); watchInput.value='';" />

                    <button class="enter-btn" title="Add Watch"
                        (click)="addWatch(watchInput.value); watchInput.value='';">
                        â
                    </button>
                </div>

                <ul class="mono">
                    <li *ngFor="let w of debugState?.watches | keyvalue">
                        {{ w.key }} = {{ w.value }}
                    </li>
                </ul>
            </div>

            <!-- EXPRESSION EVALUATOR -->
            <div class="panel">
                <h4>ğŸ§® Expression Evaluator</h4>

                <!-- âœ… input-row wrapper added -->
                <div class="input-row">
                    <input placeholder="e.g. i, sum" #exprInput (keyup.enter)="evaluateExpression(exprInput.value)" />

                    <button class="enter-btn" title="Evaluate" (click)="evaluateExpression(exprInput.value)">
                        â
                    </button>
                </div>

                <div class="eval-result" *ngIf="evalResult">
                    {{ evalResult }}
                </div>
            </div>

        </aside>
    </div>

    <!-- CALL STACK -->
    <div class="panel stack-panel" *ngIf="debugState">
        <h4>ğŸ§µ Call Stack</h4>
        <ul class="mono">
            <li *ngFor="let frame of debugState.stack">{{ frame }}</li>
        </ul>
    </div>

    <!-- LOGS -->
    <div class="panel terminal">
        <h4>ğŸ“œ Execution Logs</h4>
        <div class="status">
            <span *ngIf="compileSuccess === true" class="ok">âœ” Compiled</span>
            <span *ngIf="compileSuccess === false" class="fail">âœ– Compile Error</span>
            <span *ngIf="executeSuccess === true" class="ok">âœ” Executed</span>
            <span *ngIf="executeSuccess === false" class="fail">âœ– Runtime Error</span>
            <span *ngIf="executionTime">âš¡ {{ executionTime }} ms</span>
        </div>
        <pre class="logs">{{ logs.join('\n') }}</pre>
    </div>

</section>